<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Multi Barcode Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <style>
    body { background: #f9f9f9; font-family: Arial, sans-serif; }
    .container { max-width: 900px; margin-top: 40px; }
    .barcode { margin: 15px; display: inline-block; }
    .card { border-radius: 20px; box-shadow: 0 6px 20px rgba(0,0,0,0.1); }
    textarea { border-radius: 12px; }
    video { width: 100%; border-radius: 15px; margin-top: 10px; }
  </style>
</head>
<body>
<div class="container">
  <div class="card p-4">
    <h2 class="text-center mb-4">ðŸ“¦ Multi Barcode Generator</h2>
    
    <!-- Text Input -->
    <label class="fw-bold">Enter Text (one per line):</label>
    <textarea id="inputText" rows="5" class="form-control mb-3" placeholder="Type or paste multiple lines..."></textarea>
    <button class="btn btn-primary w-100 mb-3" onclick="generateBarcodes()">Generate Barcodes</button>

    <!-- Camera Capture -->
    <h5 class="mt-4">ðŸ“· Camera OCR (Click photo â†’ Extract text â†’ Barcode)</h5>
    <video id="camera" autoplay></video>
    <button class="btn btn-success w-100 mt-2" onclick="capturePhoto()">ðŸ“¸ Capture & Generate</button>
    <canvas id="snapshot" class="d-none"></canvas>

    <!-- Output -->
    <div id="output" class="mt-4 text-center"></div>
  </div>
</div>

<script>
  // Generate multiple barcodes
  function generateBarcodes(texts) {
    let input = texts || document.getElementById("inputText").value;
    let lines = input.split("\n").filter(l => l.trim() !== "");
    let output = document.getElementById("output");
    output.innerHTML = "";
    lines.forEach((line, i) => {
      let svg = document.createElement("svg");
      svg.classList.add("barcode");
      JsBarcode(svg, line.trim(), {format: "CODE128", width: 2, height: 60, displayValue: true});
      output.appendChild(svg);
    });
  }

  // Camera setup
  const video = document.getElementById("camera");
  navigator.mediaDevices.getUserMedia({ video: true })
    .then(stream => { video.srcObject = stream; });

  // Capture photo + OCR + barcode
  async function capturePhoto() {
    let canvas = document.getElementById("snapshot");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    let ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0);
    
    let { data: { text } } = await Tesseract.recognize(canvas, "eng");
    if(text.trim()){
      document.getElementById("inputText").value = text.trim();
      generateBarcodes(text.trim());
    } else {
      alert("No text detected!");
    }
  }
</script>
</body>
</html>
